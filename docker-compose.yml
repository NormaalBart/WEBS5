version: '3.8'

services:
  imageservice:
    build:
      context: ./imageservice
      dockerfile: /Dockerfile
    volumes:
      - ./imageservice:/app
      - ./data/images:/app/images
    ports:
      - "4000:4000"
    depends_on:
      - postgres
    environment:
      - DATABASE_URL=postgres://admin:password@postgres:5432/photoprestige
      - PORT=4000
  postgres:
    image: postgres:16
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: password
      POSTGRES_DB: photoprestige
  mailhog:
    image: mailhog/mailhog
    environment:
      MH_STORAGE: maildir
      MH_MAILDIR_PATH: /home/mailhog
    volumes:
      - ./data/mailhog:/home/mailhog
    ports:
      - "1025:1025" # SMTP server
      - "8025:8025" # Web interface
  rabbitmq:
    image: "rabbitmq:3.13-management"
    volumes:
      - "./data/rabbitmq:/var/lib/rabbitmq"
    ports:
      - "5672:5672" # AMQP protocol port
      - "15672:15672" # Web management interface
    environment:
      RABBITMQ_DEFAULT_USER: "user"
      RABBITMQ_DEFAULT_PASS: "password"